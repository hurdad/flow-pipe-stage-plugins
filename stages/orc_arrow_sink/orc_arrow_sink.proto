syntax = "proto3";

package flowpipe.stages.orc.arrow.sink.v1;

// Configuration for OrcArrowSink stage
message OrcArrowSinkConfig {
  enum CompressionStrategy {
    COMPRESSION_STRATEGY_SPEED = 0;
    COMPRESSION_STRATEGY_COMPRESSION = 1;
  }

  enum Compression {
    COMPRESSION_UNCOMPRESSED = 0;
    COMPRESSION_SNAPPY = 1;
    COMPRESSION_GZIP = 2;
    COMPRESSION_BROTLI = 3;
    COMPRESSION_ZSTD = 4;
    COMPRESSION_LZ4 = 5;
    COMPRESSION_LZ4_FRAME = 6;
    COMPRESSION_LZO = 7;
    COMPRESSION_BZ2 = 8;
  }

  message FileVersion {
    // File format major version.
    int32 major_version = 1;
    // File format minor version.
    int32 minor_version = 2;
  }

  message WriteOptions {
    // Number of rows the ORC writer writes at a time.
    int64 batch_size = 1;
    // Which ORC file version to use.
    FileVersion file_version = 2;
    // Size of each ORC stripe in bytes.
    int64 stripe_size = 3;
    // The compression codec of the ORC file.
    Compression compression = 4;
    // The size of each compression block in bytes.
    int64 compression_block_size = 5;
    // The compression strategy (speed vs size reduction).
    CompressionStrategy compression_strategy = 6;
    // The number of rows per an entry in the row index.
    int64 row_index_stride = 7;
    // The padding tolerance.
    double padding_tolerance = 8;
    // The dictionary key size threshold. 0 disables dictionary encoding.
    double dictionary_key_size_threshold = 9;
    // The array of columns that use the bloom filter.
    repeated int64 bloom_filter_columns = 10;
    // The upper limit of the false-positive rate of the bloom filter.
    double bloom_filter_fpp = 11;
  }

  enum FileSystem {
    FILE_SYSTEM_AUTO = 0;
    FILE_SYSTEM_LOCAL = 1;
    FILE_SYSTEM_S3 = 2;
    FILE_SYSTEM_GCS = 3;
    FILE_SYSTEM_HDFS = 4;
  }

  enum MemoryPool {
    MEMORY_POOL_DEFAULT = 0;
    MEMORY_POOL_SYSTEM = 1;
    MEMORY_POOL_JEMALLOC = 2;
    MEMORY_POOL_MIMALLOC = 3;
  }

  // File path to write
  string path = 1;

  // Filesystem selection
  FileSystem filesystem = 2;

  // WriteOptions
  WriteOptions write_options = 3;

  // Memory pool selection
  MemoryPool memory_pool = 4;
}
