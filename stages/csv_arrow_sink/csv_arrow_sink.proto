syntax = "proto3";

package flowpipe.stages.csv.arrow.sink.v1;

// Configuration for CsvArrowSink stage
message CsvArrowSinkConfig {
  message WriteOptions {
    // Whether to write an initial header line with column names
    optional bool include_header = 1;
    // Maximum number of rows processed at a time
    //
    // The CSV writer converts and writes data in batches of N rows.
    // This number can impact performance.
    optional int64 batch_size = 2;
    // Field delimiter
    string delimiter = 3;
    // The string to write for null values. Quotes are not allowed in this string.
    optional string null_string = 4;
    // IO context for writing.
    string io_context = 5;
    // The end of line character to use for ending rows
    string eol = 6;
    // Quoting style
    optional QuotingStyle quoting_style = 7;
    // Quoting style of header
    //
    // Note that `QuotingStyle::Needed` and `QuotingStyle::AllValid` have the same
    // effect of quoting all column names.
    optional QuotingStyle quoting_header = 8;
  }
  enum FileSystem {
    FILE_SYSTEM_AUTO = 0;
    FILE_SYSTEM_LOCAL = 1;
    FILE_SYSTEM_S3 = 2;
    FILE_SYSTEM_GCS = 3;
    FILE_SYSTEM_HDFS = 4;
  }

  enum Compression {
    COMPRESSION_AUTO = 0;
    COMPRESSION_UNCOMPRESSED = 1;
    COMPRESSION_SNAPPY = 2;
    COMPRESSION_GZIP = 3;
    COMPRESSION_BROTLI = 4;
    COMPRESSION_ZSTD = 5;
    COMPRESSION_LZ4 = 6;
    COMPRESSION_LZ4_FRAME = 7;
    COMPRESSION_LZO = 8;
    COMPRESSION_BZ2 = 9;
  }

  enum QuotingStyle {
    QUOTING_STYLE_NEEDED = 0;
    QUOTING_STYLE_ALL_VALID = 1;
    QUOTING_STYLE_NONE = 2;
  }

  enum MemoryPool {
    MEMORY_POOL_DEFAULT = 0;
    MEMORY_POOL_SYSTEM = 1;
    MEMORY_POOL_JEMALLOC = 2;
    MEMORY_POOL_MIMALLOC = 3;
  }

  // File path to write
  string path = 1;

  // Append to existing file instead of truncating
  bool append = 2;

  // WriteOptions
  WriteOptions write_options = 3;

  // Filesystem selection
  FileSystem filesystem = 4;

  // Compression selection
  Compression compression = 5;

  // Memory pool selection
  MemoryPool memory_pool = 6;
}
