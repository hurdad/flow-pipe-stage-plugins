syntax = "proto3";

package flowpipe.stages.json.arrow.source.v1;

// Configuration for JsonArrowSource stage
message JsonArrowSourceConfig {
  message ReadOptions {
    // Whether to use the global CPU thread pool
    optional bool use_threads = 1;
    // Block size we request from the IO layer; also determines the size of
    // chunks when use_threads is true
    optional int64 block_size = 2;
  }

  enum UnexpectedFieldBehavior {
    UNEXPECTED_FIELD_BEHAVIOR_INFER_TYPE = 0;
    UNEXPECTED_FIELD_BEHAVIOR_IGNORE = 1;
    UNEXPECTED_FIELD_BEHAVIOR_ERROR = 2;
  }

  message ParseOptions {
    // Optional explicit schema (disables type inference on those fields)
    bytes explicit_schema = 1;
    // Whether objects may be printed across multiple lines (for example pretty-printed)
    //
    // If true, parsing may be slower.
    optional bool newlines_in_values = 2;
    // How JSON fields outside of explicit_schema (if given) are treated
    UnexpectedFieldBehavior unexpected_field_behavior = 3;
  }

  enum OutputType {
    OUTPUT_TYPE_TABLE = 0;
    OUTPUT_TYPE_RECORD_BATCH = 1;
  }

  enum FileSystem {
    FILE_SYSTEM_AUTO = 0;
    FILE_SYSTEM_LOCAL = 1;
    FILE_SYSTEM_S3 = 2;
    FILE_SYSTEM_GCS = 3;
    FILE_SYSTEM_HDFS = 4;
  }

  enum Compression {
    COMPRESSION_AUTO = 0;
    COMPRESSION_UNCOMPRESSED = 1;
    COMPRESSION_SNAPPY = 2;
    COMPRESSION_GZIP = 3;
    COMPRESSION_BROTLI = 4;
    COMPRESSION_ZSTD = 5;
    COMPRESSION_LZ4 = 6;
    COMPRESSION_LZ4_FRAME = 7;
    COMPRESSION_LZO = 8;
    COMPRESSION_BZ2 = 9;
  }

  enum MemoryPool {
    MEMORY_POOL_DEFAULT = 0;
    MEMORY_POOL_SYSTEM = 1;
    MEMORY_POOL_JEMALLOC = 2;
    MEMORY_POOL_MIMALLOC = 3;
  }

  // File path to read
  string path = 1;

  // Output payload type
  OutputType output_type = 2;

  // ReadOptions
  ReadOptions read_options = 3;

  // ParseOptions
  ParseOptions parse_options = 4;

  // Filesystem selection
  FileSystem filesystem = 5;

  // Compression selection
  Compression compression = 6;

  // Memory pool selection
  MemoryPool memory_pool = 7;
}
